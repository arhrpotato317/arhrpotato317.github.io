---
layout: post
published: true
title: Volleyball Project 개발일지 02
date: '2020-02-20'
categories: [volleyballProject]
tags: [volleyball, project, python]
---

## [ 스파르타 코딩클럽 개발일지 7주차 ]

### 발표내용
- 이번주 프로젝트 목표 : 데이터베이스에 최초 데이터 저장하기 및 화면 개발 계획 세우기

## Project Development

{: .box-note}
**발리뽕(Volley Bbong)**

### 1. 데이터베이스에 저장하기 위한 데이터 크롤링과 포지션변화 로직 개발

#### 1-1. 요청정보를 받아 크롤링
- 필요한 데이터를 크롤링 하기 위해 사용자에게 요청정보를 받는다.
  - 사용자는 SelectBox로 선택 : 경기년도/월, 경기번호, 경기팀, 배구선수

#### 1-2. 클롤링 하기 위한 URL정리
- 크롤링을 하기 위해 URL 파라미터 값의 변화를 분석한다.
1) 경기년도/월에 해당하는 경기정보 페이지
  {% highlight javascript linenos %}
  gameMonthPage = requests.get('https://www.kovo.co.kr/game/v-league/11110_schedule_list.asp?season=016&team=&yymm='+gameMonth, headers=headers)
  {% endhighlight %}
  - gameMonth : 사용자에게 받은 경기년도/월
  - 이 페이지에서 사용자에게 받은 경기번호로 해당하는 경기라운드를 찾는다.
2) 선택한 배구경기의 상세결과 페이지
  {% highlight javascript linenos %}
  gameDetailPage = requests.get('https://www.kovo.co.kr/game/v-league/11141_game-summary.asp?season=016&g_part=201&r_round='+gameRound+'&g_num='+gameNum+'&', headers=headers)
  {% endhighlight %}
  - gameRound : 경기정보 페이지에서 찾은 경기라운드
  - gameNum : 사용자에게 받은 경기번호
  - 이 페이지에서 경기일자 / 우리팀 / 상대팀 / 우리팀의 최종 경기결과를 크롤링한다.
  - 이 페이지에서 센터선수와 리베로선수의 선수명을 크롤링한다.
3) 선택한 배구경기의 문자중계 페이지
  {% highlight javascript linenos %}
  gameCastPage = requests.get('https://www.kovo.co.kr/media/popup_result.asp?season=016&g_part=201&r_round='+gameRound+'&g_num='+gameNum, headers=headers)
  {% endhighlight %}
  - gameRound : 경기정보 페이지에서 찾은 경기라운드
  - gameNum : 사용자에게 받은 경기번호
  - 이 페이지에서 선수들의 첫번째 포지션을 크롤링하고 SET의 총 개수를 찾는다.

#### 1-3. 문자중계 페이지
- 문자중계 페이지에서 각 SET별 URL의 변화가 있기때문에 반복문을 사용하여 세트별로 정보를 크롤링해야 한다.
{% highlight javascript linenos %}
gameSetPage = requests.get('https://www.kovo.co.kr/media/popup_result.asp?season=016&g_part=201&r_round='+gameRound+'&g_num='+gameNum+'&r_set='+str(set), headers=headers)
{% endhighlight %}

- 각 세트의 스코어를 배열에 담고 배열의 길이가 랠리의 총 개수가 된다.
  - 스코어의 변화에 따라 T(득점)/F(실점)의 정보가 정해진다.
  - 랠리의 총 개수가 필요한 이유 : 랠리마다의 선수의 포지션변화는 크롤링할 수 있는 정보가 없다.   
    때문에 랠리의 총 개수를 이용하여 반복문을 돌려 로테이션이 돌아가게끔 직접 코드를 작성해야 한다. (각 포지션에 어떤 선수가 위치하고 있는지 정보가 필요하기 때문)

#### 1-4. 로테이션의 일시정지
- 배구의 규칙에 따라 각 랠리에서 로테이션의 유무가 각기 정해진다. 예외사항을 만들어 조건문으로 처리해준다.
- 예외사항 1) 랠리에서 F(실점)가 나온 후 첫 T(득점)가 돌아올때만 로테이션이 발생한다.
- 예외사항 2) 센터가 5번과 6번 포지션에 있을 때 리베로와 선수교체가 일어난다.
  - 센터선수와 리베로 선수를 크롤링하여 변수를 미리 선언해준다. (상수)

#### 1-5.
- 사용자의 팀선택에 따라 크롤링의 데이터 결과가 달라짐을 고려하여 조건문으로 처리하였다.

{: .box-error}
필요한 정보를 얻기 위해 추가적으로 다른 정보도 계속 필요해지면서 개발할 때 복잡함과 어려움을 느꼈다.

### 2. 화면 개발 계획하기
- 사용자의 요청정보와 일치하는 데이터 찾기
  - SelectBox : 경기년도/월, 경기번호, 경기팀, 배구선수
- 사용자가 어떤 option값을 선택하는지에 따라 다음 SelectBox의 option값이 달라져야한다.
  - Ajax를 사용하여 사용자의 선택에 해당하는 값을 가져올 수 있도록 크롤링하여 통신한다.
- 선택한 선수의 각 포지션에서의 득점과 실점의 개수를 가져와 마진값을 구한다. (마진 : 득점 - 실점)
  - 각 포지션에서의 선수정보를 데이터베이스에 저장한다.
  - 사용자가 요청한 정보가 이미 데이터베이스에 저장되어 있다면 다시 저장하지 않고 이미 저장된 정보를 불러와 데이터의 중복저장을 피할 수 있도록 한다.

#### 고민하기
- 사용하는 변수의 규칙 생각하기
- 데이터베이스에서의 데이터 중복 예방하기
	- 사용자가 입력한 정보가 이미 있다면 데이터베이스에 같은 정보가 저장되는 것을 막는다.
  - 해당 경기일자를 기준으로 판단하는 방법 생각해보기
- 배구 경기의 규칙에 따른 다양한 예외사항
	- 선수 교체
- 다양한 사용자 입력을 테스트 하여 에러발생 예방하기